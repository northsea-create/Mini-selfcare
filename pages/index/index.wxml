<!--index.wxml-->
<navigation-bar title="Weixin" back="{{false}}" color="black" background="#FFF"></navigation-bar>
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- 主标题 -->
    <view class="title">歇会</view>
    
    <!-- 休息插画 -->
    <view class="illustration">
      <image class="rest-illustration" src="/images/rest.svg" mode="aspectFit"></image>
    </view>

    <!-- 主按钮 -->
    <button 
      class="rest-btn" 
      bindtap="handleRest"
      loading="{{isLoading}}"
    >
      歇1分钟
    </button>

    <!-- 模态窗口 -->
    <view class="modal {{isCollapsing ? 'collapsing' : ''}}" wx:if="{{isTimerVisible || isShowingCongrats}}">
      <view class="modal-content {{isCollapsing ? 'content-collapsing' : ''}}">
        <!-- 计时器内容 -->
        <block wx:if="{{!isShowingCongrats}}">
          <view class="close-btn" bindtap="handleClose">×</view>
          <view class="{{isCollapsing ? 'hide' : ''}}">
            <!-- 生成的图片展示区 -->
            <view class="image-section" wx:if="{{imageUrl}}">
              <image class="generated-image" src="{{imageUrl}}" mode="widthFix"></image>
            </view>

            <!-- 倒计时组件 -->
            <view class="timer-section">
              <view class="progress-bar">
                <view class="progress" style="width: {{progressWidth}}%"></view>
              </view>
              <view class="time-text">{{timeLeft}}s</view>
              <button class="control-btn" bindtap="handlePause">
                {{isPaused ? '继续' : '暂停'}}
              </button>
            </view>
          </view>
        </block>

        <!-- 祝贺消息 -->
        <block wx:if="{{isShowingCongrats}}">
          <view class="congrats show-congrats">
            <image class="congrats-image" src="/images/self-love.svg" mode="aspectFit"></image>
            <view class="congrats-text">恭喜你，又成功爱自己一分钟</view>
            <view class="congrats-close-btn" bindtap="handleClose">完成</view>
          </view>
        </block>
      </view>
    </view>
  </view>
</scroll-view>
